:imagesdir: images
:icons: font
:source-highlighter: prettify


= Lab 5: Deploy IoT Components

== IoT Data Transports

Due to its unique requirements (less compute capable devices, low power use, small message payload and large number of devices), IoT requires different data transport protocols than other use cases e.g. mobile, client/server or embedded. Some of the commonly used data transport protocols for IoT include MQTT, CoAP, LWM2M and AMQP. For this lab, MQTT is being used as the data transport for assets sending location data to message broker.

=== Deploying AMQ

Red Hat JBoss AMQ provides fast, lightweight, and secure messaging  and supports AMQP, MQTT, STOMP, and WebSocket protocols. For this lab, a containerized xPaaS image of AMQ, designed for use with OpenShift, is being used. A series of templates are also available to streamline the deployment of AMQ onto OpenShift.

* Deploy the AMQ image to OpenShift by by executing the following command which will instantiate the template provided by the platform:

[source,bash]
----
$ oc process -p MQ_USERNAME=iot-serverless -p MQ_PASSWORD=iot-serverless -p MQ_PROTOCOL=openwire,mqtt -p AMQ_MESH_DISCOVERY_TYPE=dns openshift//amq63-persistent | oc apply -f-
----
The AMQ broker will be created to support accepting MQTT messages from the IoT device along with the default Openwire protocol.

* A DeploymentConfig called broker-amq was created to manage the deployment of the Broker. To illustrate the configuration of the AMQ broker, describe the contents of the broker-amq DeploymentConfig:

[source,bash]
----
$ oc describe dc broker-amq
----
NOTE: Key items to note within the podTemplate is a container called broker-amq and the exposure of port 1883, which is the default port for the MQTT protocol along with an environment variable called AMQ_TRANSPORTS which enables both the OpenWire and MQTT protocols on the broker.

* Confirm the broker is running by verifying the pod is up and running using the following command:

[source,bash]
----
$ oc get pods -l application=broker
----
A READY column indicating 1/1 denotes the service is ready and available

[.text-center]
image:icons/icon-previous.png[align=left, width=128, link=lab_4.html] image:icons/icon-home.png[align="center",width=128, link=lab_content.html] image:icons/icon-next.png[align="right"width=128, link=lab_6.html]
